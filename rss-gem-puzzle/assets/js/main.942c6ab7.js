document.addEventListener("DOMContentLoaded",(()=>{new class{constructor(e){this.setting=e,this.movesElem=document.querySelector(this.setting.moves),this.wrap=document.querySelector(this.setting.wrap),this.startBtn=document.querySelector(this.setting.startBtn),this.stopBtn=document.querySelector(this.setting.stopBtn),this.saveBtn=document.querySelector(this.setting.saveBtn),this.resultBtn=document.querySelector(this.setting.resultBtn),this.timerElem=document.querySelector(this.setting.timerElem),this.frameSizeInfoElem=document.querySelector(this.setting.frameSizeInfoElem),this.frameSizeInfoElem=document.querySelector(this.setting.frameSizeInfoElem),this.info=[{id:3,time:{minutes:0,seconds:0},moves:0,blocksMap:[],winnerBlocksResult:[],best:{time:{minutes:0,seconds:0},moves:0}},{id:4,time:{minutes:0,seconds:0},moves:0,blocksMap:[],winnerBlocksResult:[],best:{time:{minutes:0,seconds:0},moves:0}},{id:5,time:{minutes:0,seconds:0},moves:0,blocksMap:[],winnerBlocksResult:[],best:{time:{minutes:0,seconds:0},moves:0}},{id:6,time:{minutes:0,seconds:0},moves:0,blocksMap:[],winnerBlocksResult:[],best:{time:{minutes:0,seconds:0},moves:0}},{id:7,time:{minutes:0,seconds:0},moves:0,blocksMap:[],winnerBlocksResult:[],best:{time:{minutes:0,seconds:0},moves:0}},{id:8,time:{minutes:0,seconds:0},moves:0,blocksMap:[],winnerBlocksResult:[],best:{time:{minutes:0,seconds:0},moves:0}}],this.frameSize=this.info.filter((e=>4==e.id))[0],this.itemSize=0,this.moves=0,this.isGame=!1,this.isTimer=0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.blocks=[],this.zeroBlock=[],this.currentBlock={},this.currentBlocksMap=[],this.winnerBlocksResult=[],this.init()}init(){this.restore(),0===this.frameSize.blocksMap.length&&this.setCurrentBlocksMap(),0===this.frameSize.winnerBlocksResult.length&&this.setWinnerBlocksResult(),this.setCanvas(),window.addEventListener("resize",(()=>{window.innerWidth<900?(this.itemSize=Math.floor(window.innerWidth/(this.frameSize.id+2)),this.setCanvas()):this.itemSize=this.setting.itemSize})),document.addEventListener("click",(e=>{if(e.target==this.canvas&&this.isGame&&this.moveBlock(e),e.target==this.startBtn&&this.start(),e.target==this.stopBtn&&this.stop(),e.target==this.saveBtn&&this.save(),e.target==this.resultBtn&&this.result(),e.target.classList.contains("frame-size")){let t=+e.target.dataset.action;this.frameSize=this.info.filter((e=>e.id===t))[0],this.frameSizeInfoElem.textContent=`${t}x${t}`,this.clearMoves(),this.clearTimer(),this.stop(),this.setCurrentBlocksMap(),this.setCanvas()}}))}setCurrentBlocksMap(){this.setWinnerBlocksResult();const e=this.winnerBlocksResult.slice(),t=[];for(let t=e.length-1;t>0;t--){let s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}for(;t.length<this.frameSize.id;)t.push(e.splice(0,this.frameSize.id));return this.currentBlocksMap=t.slice(),this.frameSize.blocksMap=t.slice(),t}setCanvas(){this.itemSize=window.innerWidth<900?Math.floor(window.innerWidth/(this.frameSize.id+2)):this.setting.itemSize,this.canvas.classList.add("game"),this.canvas.width=this.frameSize.id*this.itemSize,this.canvas.height=this.canvas.width,this.wrap.insertAdjacentElement("afterbegin",this.canvas);let e=[];for(let t=0;t<this.frameSize.id;t++)for(let s=0;s<this.frameSize.id;s++)this.ctx.save(),this.ctx.translate(s*this.itemSize+2,t*this.itemSize+2),this.ctx.fillStyle="#e2e2e2",this.ctx.fillRect(0,0,this.itemSize-4,this.itemSize-4),0===this.currentBlocksMap[t][s]?(this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.itemSize-4,this.itemSize-4),this.zeroBlock={name:this.currentBlocksMap[t][s],x:Math.floor(s*this.itemSize),y:Math.floor(t*this.itemSize),width:Math.floor(this.itemSize),height:Math.floor(this.itemSize),row:t+1,col:s+1}):this.ctx.fillStyle="#000",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=window.innerWidth<400&&this.frameSize.id>5?"12px sans-serif":"20px sans-serif",window.innerWidth<400&&this.frameSize.id,this.ctx.fillText(this.currentBlocksMap[t][s],this.itemSize/2,this.itemSize/2),this.ctx.restore(),e.push({name:this.currentBlocksMap[t][s],x:Math.floor(s*this.itemSize),y:Math.floor(t*this.itemSize),width:Math.floor(this.itemSize),height:Math.floor(this.itemSize),row:t+1,col:s+1}),this.blocks.length=0,this.blocks=e.flat()}moveBlock(e){const t=Math.floor(e.offsetX),s=Math.floor(e.offsetY),i=()=>{this.currentBlocksMap=this.currentBlocksMap.map((e=>e.map((e=>(0==e?e=this.currentBlock.name:e==this.currentBlock.name&&(e=0),e))))),this.moves+=1,this.movesElem.textContent=this.moves,this.setCanvas(),this.isSolved()?this.gameOver():this.setCanvas()};this.isClickOnBlock(t,s)&&(this.currentBlock.col==this.zeroBlock.col&&(this.currentBlock.y==this.zeroBlock.y+this.zeroBlock.height&&i(),this.currentBlock.y+this.zeroBlock.height==this.zeroBlock.y&&i()),this.currentBlock.row==this.zeroBlock.row&&(this.currentBlock.x+this.currentBlock.width==this.zeroBlock.x&&i(),this.currentBlock.x==this.zeroBlock.x+this.zeroBlock.width&&i()))}start(){document.querySelector(".message")&&document.querySelector(".message").remove(),this.frameSize.blocksMap.length=0,this.frameSize.winnerBlocksResult.length=0,0!==this.frameSize.moves&&!0!==this.isGame||this.clearMoves(),(0===this.frameSize.time.minutes&&0===this.frameSize.time.seconds||!0===this.isGame)&&this.clearTimer(),!0===this.isGame&&this.setCurrentBlocksMap(),this.setCanvas(),this.setWinnerBlocksResult(),this.timer(),this.isGame=!0,console.log("New game started")}stop(){clearInterval(this.isTimer),this.isGame=!1,console.log("Game stopped")}result(){this.message("result")}timer(){console.log("Timer Started");let{minutes:e,seconds:t}=this.frameSize.time;this.isTimer=setInterval((()=>{59==t&&(e+=1,t=0),t+=1,this.timerElem.textContent=`${String(e).length<2?0:""}${e}:${String(t).length<2?0:""}${t}`,this.frameSize.time={minutes:e,seconds:t}}),1e3)}clearTimer(){clearInterval(this.isTimer),this.timerElem.textContent="00:00",this.frameSize.time.minutes=0,this.frameSize.time.seconds=0}clearMoves(){this.moves=0,this.movesElem.textContent=0}message(e,t){const s={result:`\n      <div class="message ${e||""}">\n        <div class="message__header"><b>YOUR RESULTS</b></div>\n        <div class="message__frame-size">Frame size: ${this.frameSize.id}x${this.frameSize.id}</div>\n        <div class="message__time">Time: ${String(this.frameSize.time.minutes).length<2?0:""}${this.frameSize.time.minutes}:${String(this.frameSize.time.seconds).length<2?0:""}${this.frameSize.time.seconds}</div>\n        <div class="message__moves">Moves: ${this.moves}</div>\n        <div class="message__moves"><b>Best result:</b> Moves: ${this.frameSize.best.moves} | Time: ${String(this.frameSize.best.time.minutes).length<2?0:""}${this.frameSize.best.time.minutes}:${String(this.frameSize.best.time.seconds).length<2?0:""}${this.frameSize.best.time.seconds}</div>\n        <button class="message__button">Close</button>\n      </div>`,winner:`\n      <div class="message ${e||""}">\n        <div class="message__header"><b>Hooray! You solved the puzzle in ${String(this.frameSize.time.minutes).length<2?0:""}${this.frameSize.time.minutes}:${String(this.frameSize.time.seconds).length<2?0:""}${this.frameSize.time.seconds} and ${this.moves} moves!</b></div>\n        <div class="message__moves"><b>Best result:</b> Moves: ${this.frameSize.best.moves} | Time: ${String(this.frameSize.best.time.minutes).length<2?0:""}${this.frameSize.best.time.minutes}:${String(this.frameSize.best.time.seconds).length<2?0:""}${this.frameSize.best.time.seconds}</div>\n        <button class="message__button">Close</button>\n      </div>`,message:`\n      <div class="message ${e||""}">\n        <div class="message__body">${t}</div>\n        <button class="message__button">Close</button>\n      </div>`};for(let t in s)t==e&&(document.querySelector(".message")&&document.querySelector(".message").remove(),this.wrap.insertAdjacentHTML("afterbegin",s[t]),document.querySelector(".message__button").addEventListener("click",(()=>document.querySelector(".message").remove())))}save(){this.frameSize.moves=this.moves,this.frameSize.blocksMap=this.currentBlocksMap.slice(),this.frameSize.winnerBlocksResult=this.winnerBlocksResult.slice(),localStorage.setItem("info",JSON.stringify(this.info)),console.log("Game saved")}restore(){localStorage.getItem("info")&&(this.info=JSON.parse(localStorage.getItem("info")),this.timerElem.textContent=`${String(this.frameSize.time.minutes).length<2?0:""}${this.frameSize.time.minutes}:${String(this.frameSize.time.seconds).length<2?0:""}${this.frameSize.time.seconds}`,this.frameSizeInfoElem.textContent=`${this.frameSize.id}x${this.frameSize.id}`,this.movesElem.textContent=this.frameSize.moves,this.moves=this.frameSize.moves,this.currentBlocksMap=0!==this.frameSize.blocksMap.length&&this.frameSize.blocksMap.slice())}isClickOnBlock(e,t){for(let s of this.blocks)if(e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height)return this.currentBlock=s,!0;return!1}setWinnerBlocksResult(){this.winnerBlocksResult=[...Array(this.frameSize.id*this.frameSize.id).keys()]}isSolved(){const e=this.winnerBlocksResult.slice(),t=this.currentBlocksMap.flat();return e.splice(0,1),t.splice(t.length-1,1),e.every(((e,s)=>e==t[s]))}gameOver(){this.frameSize.best.time.minutes=this.frameSize.time.minutes,this.frameSize.best.time.seconds=this.frameSize.time.seconds,this.frameSize.best.moves=this.moves,this.save(),this.message("winner","YOU WON!!!"),console.log("Winner!")}}({wrap:".game-container",startBtn:".start",stopBtn:".stop",saveBtn:".save",resultBtn:".result",timerElem:".timer span",moves:".moves span",frameSizeInfoElem:".frame-size-info span",itemSize:80})}));
//# sourceMappingURL=main.942c6ab7.js.map