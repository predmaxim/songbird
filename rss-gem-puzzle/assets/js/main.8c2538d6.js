document.addEventListener("DOMContentLoaded",(()=>{new class{constructor(t){this.setting=t,this.movesElem=document.querySelector(this.setting.moves),this.wrap=document.querySelector(this.setting.wrap),this.startBtn=document.querySelector(this.setting.startBtn),this.stopBtn=document.querySelector(this.setting.stopBtn),this.saveBtn=document.querySelector(this.setting.saveBtn),this.resultBtn=document.querySelector(this.setting.resultBtn),this.timerElem=document.querySelector(this.setting.timerElem),this.frameSizeInfoElem=document.querySelector(this.setting.frameSizeInfoElem),this.frameSizeInfoElem=document.querySelector(this.setting.frameSizeInfoElem),this.info={frameSize:0,moves:0,blocksMap:[],winnerBlocksResult:[],time:{minutes:0,seconds:0},best:{time:{minutes:0,seconds:0},moves:0,frameSize:0}},this.frameSize=0!==this.info.frameSize?this.info.frameSize:4,this.itemSize=0,this.moves=0,this.isGame=!1,this.isTimer=0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.blocks=[],this.zeroBlock=[],this.currentBlock={},this.currentBlocksMap=[],this.winnerBlocksResult=[],this.init()}init(){this.restore(),0===this.info.blocksMap.length&&this.setCurrentBlocksMap(),0===this.info.winnerBlocksResult.length&&this.setWinnerBlocksResult(),this.setCanvas(),window.addEventListener("resize",(()=>{window.innerWidth<900?(this.itemSize=Math.floor(window.innerWidth/(this.frameSize+2)),this.setCanvas()):this.itemSize=this.setting.itemSize})),document.addEventListener("click",(t=>{t.target==this.canvas&&this.isGame&&this.moveBlock(t),t.target==this.startBtn&&this.start(),t.target==this.stopBtn&&this.stop(),t.target==this.saveBtn&&this.save(),t.target==this.resultBtn&&this.result(),t.target.classList.contains("frame-size")&&(this.frameSize=+t.target.dataset.action,this.frameSizeInfoElem.textContent=`${+t.target.dataset.action}x${+t.target.dataset.action}`,this.info.frameSize=this.frameSize,this.moves=0,this.movesElem.textContent=0,this.info.time.minutes=0,this.info.time.seconds=0,this.timerElem.textContent="00:00",this.stop(),this.setCanvas())}))}setCurrentBlocksMap(){0===this.winnerBlocksResult.length&&this.setWinnerBlocksResult();const t=this.winnerBlocksResult.slice(),e=[];for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}for(;e.length<this.frameSize;)e.push(t.splice(0,this.frameSize));return console.log(t),this.currentBlocksMap=e.slice(),this.info.blocksMap=e.slice(),e}setCanvas(){this.itemSize=window.innerWidth<900?Math.floor(window.innerWidth/(this.frameSize+2)):this.setting.itemSize,this.canvas.classList.add("game"),this.canvas.width=this.frameSize*this.itemSize,this.canvas.height=this.canvas.width,this.wrap.insertAdjacentElement("afterbegin",this.canvas);let t=[];for(let e=0;e<this.frameSize;e++)for(let s=0;s<this.frameSize;s++)this.ctx.save(),this.ctx.translate(s*this.itemSize+2,e*this.itemSize+2),this.ctx.fillStyle="#e2e2e2",this.ctx.fillRect(0,0,this.itemSize-4,this.itemSize-4),0===this.currentBlocksMap[e][s]?(this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.itemSize-4,this.itemSize-4),this.zeroBlock={name:this.currentBlocksMap[e][s],x:Math.floor(s*this.itemSize),y:Math.floor(e*this.itemSize),width:Math.floor(this.itemSize),height:Math.floor(this.itemSize),row:e+1,col:s+1}):this.ctx.fillStyle="#000",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=window.innerWidth<400&&this.frameSize>5?"12px sans-serif":"20px sans-serif",window.innerWidth<400&&this.frameSize,this.ctx.fillText(this.currentBlocksMap[e][s],this.itemSize/2,this.itemSize/2),this.ctx.restore(),t.push({name:this.currentBlocksMap[e][s],x:Math.floor(s*this.itemSize),y:Math.floor(e*this.itemSize),width:Math.floor(this.itemSize),height:Math.floor(this.itemSize),row:e+1,col:s+1}),this.blocks.length=0,this.blocks=t.flat()}moveBlock(t){const e=Math.floor(t.offsetX),s=Math.floor(t.offsetY),i=()=>{this.currentBlocksMap=this.currentBlocksMap.map((t=>t.map((t=>(0==t?t=this.currentBlock.name:t==this.currentBlock.name&&(t=0),t))))),this.moves+=1,this.movesElem.textContent=this.moves,this.setCanvas(),this.isSolved()?this.gameOver():this.setCanvas()};this.isClickOnBlock(e,s)&&(this.currentBlock.col==this.zeroBlock.col&&(this.currentBlock.y==this.zeroBlock.y+this.zeroBlock.height&&i(),this.currentBlock.y+this.zeroBlock.height==this.zeroBlock.y&&i()),this.currentBlock.row==this.zeroBlock.row&&(this.currentBlock.x+this.currentBlock.width==this.zeroBlock.x&&i(),this.currentBlock.x==this.zeroBlock.x+this.zeroBlock.width&&i()))}start(){document.querySelector(".message")&&document.querySelector(".message").remove(),this.info.blocksMap.length=0,this.info.winnerBlocksResult.length=0,0!==this.info.moves&&!0!==this.isGame||(this.moves=0,this.movesElem.textContent=0),(0===this.info.time.minutes&&0===this.info.time.seconds||!0===this.isGame)&&(this.info.time.minutes=0,this.info.time.seconds=0,this.timerElem.textContent="00:00",clearInterval(this.isTimer)),!0===this.isGame&&this.setCurrentBlocksMap(),this.setCanvas(),this.setWinnerBlocksResult(),this.timer(),this.isGame=!0,console.log("New game started")}stop(){clearInterval(this.isTimer),this.isGame=!1,console.log("Game stopped")}result(){this.message("result")}timer(){console.log("Timer Started");let{minutes:t,seconds:e}=this.info.time;this.isTimer=setInterval((()=>{59==e&&(t+=1,e=0),e+=1,this.timerElem.textContent=`${String(t).length<2?0:""}${t}:${String(e).length<2?0:""}${e}`,this.info.time={minutes:t,seconds:e}}),1e3)}message(t,e){const s={result:`\n      <div class="message ${t||""}">\n        <div class="message__header"><b>YOUR RESULTS</b></div>\n        <div class="message__frame-size">Frame size: ${this.frameSize}x${this.frameSize}</div>\n        <div class="message__time">Time: ${String(this.info.time.minutes).length<2?0:""}${this.info.time.minutes}:${String(this.info.time.seconds).length<2?0:""}${this.info.time.seconds}</div>\n        <div class="message__moves">Moves: ${this.info.moves}</div>\n        <div class="message__moves"><b>Best result:</b> Moves: ${this.info.best.moves} | Time: ${String(this.info.best.time.minutes).length<2?0:""}${this.info.best.time.minutes}:${String(this.info.best.time.seconds).length<2?0:""}${this.info.best.time.seconds}</div>\n        <button class="message__button">Close</button>\n      </div>`,winner:`\n      <div class="message ${t||""}">\n        <div class="message__header"><b>${e}</b></div>\n        <div class="message__time">Time: ${String(this.info.time.minutes).length<2?0:""}${this.info.time.minutes}:${String(this.info.time.seconds).length<2?0:""}${this.info.time.seconds}</div>\n        <div class="message__moves">Moves: ${this.info.moves}</div>\n        <div class="message__moves"><b>Best result:</b> Moves: ${this.info.best.moves} | Time: ${String(this.info.best.time.minutes).length<2?0:""}${this.info.best.time.minutes}:${String(this.info.best.time.seconds).length<2?0:""}${this.info.best.time.seconds}</div>\n        <button class="message__button">Close</button>\n      </div>`,message:`\n      <div class="message ${t||""}">\n        <div class="message__body">${e}</div>\n        <button class="message__button">Close</button>\n      </div>`};for(let e in s)e==t&&(document.querySelector(".message")&&document.querySelector(".message").remove(),this.wrap.insertAdjacentHTML("afterbegin",s[e]),document.querySelector(".message__button").addEventListener("click",(()=>document.querySelector(".message").remove())))}save(){this.info.frameSize=this.frameSize,this.info.moves=this.moves,this.info.blocksMap=this.currentBlocksMap.slice(),this.info.winnerBlocksResult=this.winnerBlocksResult.slice(),localStorage.setItem("info",JSON.stringify(this.info)),console.log("Game saved")}restore(){localStorage.getItem("info")&&(this.info=JSON.parse(localStorage.getItem("info")),this.timerElem.textContent=`${String(this.info.time.minutes).length<2?0:""}${this.info.time.minutes}:${String(this.info.time.seconds).length<2?0:""}${this.info.time.seconds}`,this.frameSize=this.info.frameSize,this.frameSizeInfoElem.textContent=`${this.frameSize}x${this.frameSize}`,this.movesElem.textContent=this.info.moves,this.moves=this.info.moves,this.currentBlocksMap=0!==this.info.blocksMap.length&&this.info.blocksMap.slice())}isClickOnBlock(t,e){for(let s of this.blocks)if(t>=s.x&&t<=s.x+s.width&&e>=s.y&&e<=s.y+s.height)return this.currentBlock=s,!0;return!1}setWinnerBlocksResult(){this.winnerBlocksResult=[...Array(this.frameSize*this.frameSize).keys()]}isSolved(){const t=this.winnerBlocksResult.slice(),e=this.currentBlocksMap.flat();return t.splice(0,1),e.splice(e.length-1,1),t.every(((t,s)=>t==e[s]))}gameOver(){this.info.best.time.minutes=this.info.time.minutes,this.info.best.time.seconds=this.info.time.seconds,this.info.best.moves=this.moves,this.info.best.frameSize=this.frameSize,this.save(),this.message("winner","You winner!!!"),console.log("Winner!")}}({wrap:".game-container",startBtn:".start",stopBtn:".stop",saveBtn:".save",resultBtn:".result",timerElem:".timer span",moves:".moves span",frameSizeInfoElem:".frame-size-info span",itemSize:80})}));
//# sourceMappingURL=main.8c2538d6.js.map